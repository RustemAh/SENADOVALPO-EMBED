<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Elección Regional — Valparaíso 2025</title>
<style>
:root { color-scheme: light; }
body { margin:0; font-family: Arial, Roboto, sans-serif; background:#fff; }
.wrap { max-width:720px; margin:0 auto; border:1px solid #ddd; border-radius:10px; overflow:hidden; }
.hd { padding:14px 16px; border-bottom:1px solid #eee; display:flex; justify-content:space-between; flex-wrap:wrap; align-items:center; }
.hd h2 { margin:0; font-size:19px; font-weight:700; }
.ts { font-size:12px; color:#6b7280; margin-top:4px; }
.banner { background:#FFD400; padding:10px 16px; font-weight:700; text-transform:uppercase; border-bottom:1px solid #eee; }

.list-header { background:#f9fafb; color:#111; font-weight:700; border-top:2px solid #ddd; padding:10px 16px; }
.list-header .stats-side { color:#9ca3af; }
</style>
</head>
<body>
<div class="wrap">
  <div class="hd">
    <div>
      <h2>Elección Regional — Valparaíso 2025</h2>
      <div class="ts" id="ts">—</div>
    </div>
  </div>

  <div id="banner" class="banner">ASIGNACIÓN DE 5 ESCAÑOS — MÉTODO D’HONDT (por lista; mostrado por partido)</div>

  <div id="rows"></div>

  <script>
  const DATA_URL="https://docs.google.com/spreadsheets/d/1lFbOXepc2zPXOUIOhTRnP4q9Ry_oye_9zHJ1HX_9Njc/export?format=csv";

  async function fetchCSV(url){
    const r=await fetch(url+"?t="+Date.now(),{cache:"no-store"});
    return await r.text();
  }

  function parseCSV(text){
    const clean=text.replace(/\r/g,"").replace(/\n{2,}/g,"\n");
    const lines=clean.trim().split("\n");
    const headers=lines.shift().split(",").map(h=>h.trim().toLowerCase());
    return lines.map(line=>{
      const cols=line.split(","); const obj={};
      headers.forEach((h,i)=>obj[h]=cols[i]?.trim()||"");
      return obj;
    });
  }

  function cleanListName(name){
    return String(name||"")
      .replace(/\n/g," ")                   // elimina saltos de línea internos
      .replace(/^["“”']+|["“”']+$/g,"")     // elimina comillas
      .replace(/^lista\s*[A-ZÁÉÍÓÚÑ]\.\s*/i,"") // elimina "Lista B." o "Lista C."
      .trim();
  }

  async function load(){
    const csv=await fetchCSV(DATA_URL);
    const rows=parseCSV(csv);
    const container=document.getElementById("rows");
    container.innerHTML="";
    rows.forEach(r=>{
      const name=r.candidate||r.nombre||"";
      if(name.toLowerCase().includes("lista")){
        const listName=cleanListName(name);
        container.innerHTML+=`
          <div class="list-header">${listName}</div>
        `;
      }
    });
  }

  load();
  </script>
</div>
</body>
</html>

